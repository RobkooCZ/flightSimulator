# HERE YOU WILL FIND ALL THE PHYSICS BEHIND THE AIRCRAFT SIMULATOR

## Table of Contents
- [Introduction](#introduction)
- [Coordinate System](#coordinate-system)
- [Forces](#forces)
  - [Gravity](#gravity)
  - [Thrust](#thrust)
  - [Lift](#lift)
    - [Lift Coefficient](#step-2-lift-coefficient-)
  - [Drag](#drag)
    - [Drag Coefficient](#step-2-drag-coefficient-)
- [Atmospheric Model](#atmospheric-model)
- [Angle of Attack (AoA)](#angle-of-attack-aoa)
- [True Airspeed (TAS)](#true-airspeed-tas)
- [Numerical Integration](#numerical-integration)

## Introduction 
This document provides an overview of the physics calculations used in the flight simulator. The simulator models the behavior of an aircraft by calculating the forces acting on it and updating its state over time.

## Coordinate System
The simulator uses a right-handed coordinate system:
- **X-axis**: Forward direction
- **Y-axis**: Upward direction
- **Z-axis**: Right direction

## Forces

### Gravity
Gravity is a constant force acting downward on the aircraft. It is calculated as:

$$-g \times m$$

Where $g$ is the gravitational constant equal to 9.81 m/s², and $m$ is the mass of the aircraft in kg.

Note: The negative sign is used because gravity pulls the aircraft downward, lowering the Y-vector.

### Thrust
Thrust is the force generated by the aircraft's engines. It is calculated based on the throttle setting and whether the afterburner is active. The thrust calculation is as follows:

#### Step 1:
Determine which thrust to use. If the throttle percentage ($P$) is over 100, the afterburner is engaged and the afterburner (wet) thrust is used; otherwise, the military (dry) thrust is used.

$$
T_{\text{used}} =
\begin{cases}
T_{\text{afterburner}}, & \text{if } P > 100 \\
T_{\text{normal}}, & \text{otherwise}
\end{cases}
$$

Where:
- $P$ is the percent control input provided by the user.
- $T_{\text{afterburner}}$ is the wet thrust of the engine.
- $T_{\text{normal}}$ is the dry thrust of the engine.

#### Step 2:
Apply altitude derating. Air density decreases as altitude increases; thus, less air means less thrust.

$$
T_{\text{altitude}} = T_{\text{used}} \times \left(\frac{\rho(h)}{\rho_0}\right)
$$

Where:
- $T_{\text{used}}$ is the thrust determined in Step 1.
- $\rho(h)$ is the air density (in kg/m³) at altitude $h$ (in m).
- $\rho_0$ is the air density at sea level (in kg/m³).

#### Step 3:
Apply the throttle percentage to the altitude-adjusted thrust.

$$
T_{\text{control}} = \left(\frac{P}{100}\right) \times T_{\text{altitude}}
$$

Where $P$ is the user input percentage.

#### Step 4:
Adjust thrust based on aircraft speed using the Ram Recovery effect. For most jets, as speed increases (up to about Mach 2), engine thrust increases.

$$
T_{\text{speed}} = T_{\text{control}} \times \left(1 + k_{\text{ram}} \times M\right)
$$

Where:
- $T_{\text{control}}$ is the thrust calculated in Step 3.
- $k_{\text{ram}}$ is the Ram Recovery factor (estimated to be 0.3 for a turbojet).
- $M$ is the Mach number of the aircraft (calculated using TAS).

#### Step 5:
Cap the thrust to the maximum value determined in Step 1.

$$
T_{\text{final}} = \min\left(T_{\text{speed}}, T_{\text{used}}\right)
$$

Where:
- $\min()$ returns the smaller of $T_{\text{speed}}$ and $T_{\text{used}}$.

#### Full Formula:
The complete thrust formula is:

$$
T_{\text{final}} = \min\left(\left(\frac{P}{100}\right) \times T_{\text{used}} \times \left(\frac{\rho(h)}{\rho_0}\right) \times \left(1 + k_{\text{ram}} \times M\right), T_{\text{used}}\right)
$$

### Lift
Lift is the force acting perpendicular to the relative wind that supports the aircraft in the air. It is calculated as follows:

#### Step 1: Flight Path Angle
First, compute the flight path angle ($\gamma$):

$$
\gamma = \arcsin\left(\frac{v_z}{V}\right)
$$

Where:
- $\arcsin$ is the inverse sine function.
- $v_z$ is the vertical component of the velocity.
- $V$ is the True Airspeed (TAS) in m/s.

#### Step 2: Lift Coefficient ($C_{\ell}$)
Depending on flight conditions, the lift coefficient is computed as:

- **If the aircraft is turning:**

  $$
  C_{\ell} = \frac{mg}{0.5\, \rho\, V^2\, S\,\cos(\phi)}
  $$

- **If the aircraft is in level flight:**

  $$
  C_{\ell} = \frac{mg}{0.5\,\rho\,V^2\,S}
  $$

- **If the aircraft is climbing or descending:**

  $$
  C_{\ell} = \frac{mg\,\cos(\gamma)}{0.5\,\rho\,V^2\,S}
  $$

Where:
- $m$ is the mass of the aircraft in kg.
- $g$ is 9.81 m/s².
- $\rho$ is the air density at the current altitude ($kg/m^3$).
- $V$ is the TAS in m/s.
- $S$ is the wing area ($m^2$).
- $\phi$ is the bank angle (in degrees).
- $\gamma$ is the flight path angle (in radians).

#### Step 3: Lift Force
The lift force ($L$) is calculated by:

$$
L = 0.5\,\rho\,V^2\,S\,C_{\ell}
$$

Where the variables are as defined above.

### Drag
Drag is the force opposing the aircraft's motion through the air. It is composed of parasitic drag, induced drag, and (at high speeds) wave drag.

#### Step 1: Aspect Ratio ($AR$)
Calculate the aspect ratio of the aircraft:

$$
AR = \frac{b^2}{S}
$$

Where:
- $b$ is the wingspan (m).
- $S$ is the wing area (m²).

#### Step 2: Drag Coefficient ($C_d$)
The drag coefficient is determined based on the Mach number ($M$) and flight regime:

- **Subsonic Flight ($M < 0.8$):**

  $$
  C_d = C_{d0} + 0.05 \times \left(\frac{V}{V_{\text{max}}}\right)^2
  $$

- **Transonic Flight ($0.8 \le M < 1.2$):**

  $$
  C_d = C_{d0} + 0.05 \times \left(\frac{V}{V_{\text{max}}}\right)^2 + \alpha\,(M-1)^2
  $$

- **Supersonic Flight ($M \ge 1.2$):**

  $$
  C_d = C_{d0} + k_\omega\,(M - M_d)^2
  $$

Where:
- $C_{d0}$ is the zero-lift drag coefficient (estimated as 0.02, dimensionless).
- $V$ is the TAS (m/s).
- $V_{\text{max}}$ is the top speed (m/s).
- $\alpha$ is the drag rise constant for transonic speeds (e.g., 0.1).
- $k_\omega$ is the drag rise constant for supersonic speeds (e.g., 30).
- $M_d$ is the drag divergence Mach number (e.g., 0.89).

#### Step 3: Parasitic Drag ($D_p$)
Parasitic drag is calculated as:

$$
D_p = 0.5 \times C_d \times \rho \times V^2 \times S
$$

Where:
- $\rho$ is the air density (kg/m³).
- $V$ is the TAS (m/s).
- $S$ is the wing area (m²).

#### Step 4: Induced Drag ($D_i$)
Induced drag is computed by:

$$
D_i = 0.5 \times \rho \times V^2 \times S \times \frac{C_{\ell}^2}{\pi \times AR \times OEF}
$$

Where:
- $OEF$ is the Oswald efficiency factor (estimated as 0.8).

#### Step 5: Wave Drag ($D_{\omega}$)
If the Mach number exceeds the drag divergence value ($M_d$), wave drag is added:

$$
D_{\omega} =
\begin{cases}
0, & \text{if } M < M_d \\
C_{D0} \times k_\omega \times (M - M_d)^2, & \text{if } M \ge M_d
\end{cases}
$$

Where:
- $C_{D0}$ is the zero-lift drag coefficient (0.02).
- $k_\omega$ is the wave drag constant (30).
- $M_d$ is the drag divergence Mach number (0.89).

#### Step 6: Total Drag Force ($D_{\text{total}}$)
The total drag is the sum of parasitic, induced, and wave drag:

$$
D_{\text{total}} = D_p + D_i + D_{\omega}
$$

Alternatively, it can be expressed as:

$$
D_{\text{total}} =
\begin{cases}
0.5\,\rho\,V^2\,S\,\left(C_d + \frac{C_{\ell}^2}{\pi\,AR\,OEF}\right), & \text{if } M < M_d \\
0.5\,\rho\,V^2\,S\,\left(C_d + \frac{C_{\ell}^2}{\pi\,AR\,OEF}\right) + C_{D0}\,k_\omega\,(M - M_d)^2, & \text{if } M \ge M_d
\end{cases}
$$

## Atmospheric Model
The atmospheric model calculates air density, temperature at altitude, and the tropopause.

### Tropopause
For Earth's atmosphere, with $\Delta T_{ISA} = 0$ (standard conditions), the tropopause height simplifies to:

$$
h_{trop} = 11000 \text{ m}
$$

For completeness, the full formula is:

$$
h_{trop} = 11000 + 1000 \times \left(\frac{\Delta T_{ISA}}{6.5}\right)
$$

Where $\Delta T_{ISA}$ is the temperature difference from the International Standard Atmosphere (ISA) in Kelvin.

### Temperature at Altitude
The temperature at an altitude $h$ (in m) is calculated as:

$$
T_h =
\begin{cases}
T_0 - 6.5 \times \left(\frac{h}{1000}\right), & \text{if } h < h_{top} \\
T_{trop}, & \text{if } h \ge h_{top}
\end{cases}
$$

Where:
- $T_0$ is the sea-level temperature (288.15 K),
- $h$ is the altitude (m),
- $T_{trop}$ is the temperature at the tropopause (216.65 K),
- $h_{top}$ is the altitude of the tropopause.

### Air Density at Altitude
Air density ($\rho$) is computed as:

$$
\rho =
\begin{cases}
\rho_0 \times \left(\frac{T_h}{T_0}\right)^{-\left(\frac{g}{K_t \times R} + 1\right)}, & \text{if } h < h_{top} \\
\rho_{top} \times e^{\left(\frac{g}{R \times T_{top}} \times (h - h_{top}) \right)}, & \text{if } h \ge h_{top}
\end{cases}
$$

Where:
- $\rho_0$ is the sea-level air density (kg/m³),
- $T_h$ is the temperature at altitude (K),
- $T_0$ is the sea-level temperature (288.15 K),
- $g$ is 9.81 m/s²,
- $K_t$ is the lapse rate (0.0065 K/m),
- $R$ is the gas constant for dry air (287.04 J/(kg·K)),
- $\rho_{top}$ is the air density at the tropopause,
- $T_{top}$ is the temperature at the tropopause,
- $h$ is the altitude (m),
- $h_{top}$ is the tropopause altitude.

## Angle of Attack (AoA)
The angle of attack is defined as the angle between the aircraft's velocity vector and its longitudinal axis. It is calculated by:

$$
\text{AoA} = \arctan\left(\frac{-v_y}{\text{horizontalSpeed}}\right)
$$

Where:
- $v_y$ is the vertical component of velocity.
- $\text{horizontalSpeed}$ is the magnitude of the horizontal component of velocity.

## True Airspeed (TAS)
True Airspeed (TAS) is the actual speed of the aircraft relative to the surrounding air, given by:

$$
\text{TAS} = \text{IAS} \times \sqrt{\frac{T_h}{T_0}}
$$

Where:
- $\text{IAS}$ is the indicated airspeed,
- $T_h$ is the temperature at the current altitude,
- $T_0$ is the sea-level temperature.

## Numerical Integration
The simulator uses numerical integration to update the aircraft's state over time. All forces are summed to determine the net force, which is then used to calculate acceleration (via Newton's second law). The aircraft's velocity and position are updated accordingly.